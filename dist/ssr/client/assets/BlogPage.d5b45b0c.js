import{c as k}from"./create-uploader-component.aeed4390.js";import{r as w,e as S,E as L,F as D,D as H,O as I,G as M}from"./index.abe876a2.js";import{Q as O}from"./QPage.a6959bd1.js";import"./axios.e13eb387.js";import"./QBtn.eed3df68.js";import"./render.a4c35192.js";import"./format.2a3572e1.js";import"./use-dark.f1a9672c.js";function d(u){return typeof u=="function"?u:()=>u}const T={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>u=>u.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},V=["factory-failed","uploaded","failed","uploading"];function j({props:u,emit:l,helpers:o}){const p=w([]),i=w([]),c=w(0),x=S(()=>({url:d(u.url),method:d(u.method),headers:d(u.headers),formFields:d(u.formFields),fieldName:d(u.fieldName),withCredentials:d(u.withCredentials),sendRaw:d(u.sendRaw),batch:d(u.batch)})),P=S(()=>c.value>0),N=S(()=>i.value.length>0);let F;function A(){p.value.forEach(e=>{e.abort()}),i.value.length>0&&(F=!0)}function Q(){const e=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],x.value.batch(e)?b(e):e.forEach(n=>{b([n])})}function b(e){if(c.value++,typeof u.factory!="function"){g(e,{});return}const n=u.factory(e);if(!n)l("factory-failed",new Error("QUploader: factory() does not return properly"),e),c.value--;else if(typeof n.catch=="function"&&typeof n.then=="function"){i.value.push(n);const s=a=>{o.isAlive()===!0&&(i.value=i.value.filter(r=>r!==n),i.value.length===0&&(F=!1),o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(r=>{o.updateFileStatus(r,"failed")}),l("factory-failed",a,e),c.value--)};n.then(a=>{F===!0?s(new Error("Aborted")):o.isAlive()===!0&&(i.value=i.value.filter(r=>r!==n),g(e,a))}).catch(s)}else g(e,n||{})}function g(e,n){const s=new FormData,a=new XMLHttpRequest,r=(t,v)=>n[t]!==void 0?d(n[t])(v):x.value[t](v),E=r("url",e);if(!E){console.error("q-uploader: invalid or no URL specified"),c.value--;return}const z=r("formFields",e);z!==void 0&&z.forEach(t=>{s.append(t.name,t.value)});let _=0,q=0,m=0,U=0,B;a.upload.addEventListener("progress",t=>{if(B===!0)return;const v=Math.min(U,t.loaded);o.uploadedSize.value+=v-m,m=v;let h=m-q;for(let y=_;h>0&&y<e.length;y++){const f=e[y];if(h>f.size)h-=f.size,_++,q+=f.size,o.updateFileStatus(f,"uploading",f.size);else{o.updateFileStatus(f,"uploading",h);return}}},!1),a.onreadystatechange=()=>{a.readyState<4||(a.status&&a.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(e),e.forEach(t=>{o.updateFileStatus(t,"uploaded")}),l("uploaded",{files:e,xhr:a})):(B=!0,o.uploadedSize.value-=m,o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(t=>{o.updateFileStatus(t,"failed")}),l("failed",{files:e,xhr:a})),c.value--,p.value=p.value.filter(t=>t!==a))},a.open(r("method",e),E),r("withCredentials",e)===!0&&(a.withCredentials=!0);const R=r("headers",e);R!==void 0&&R.forEach(t=>{a.setRequestHeader(t.name,t.value)});const C=r("sendRaw",e);e.forEach(t=>{o.updateFileStatus(t,"uploading",0),C!==!0&&s.append(r("fieldName",t),t,t.name),t.xhr=a,t.__abort=()=>{a.abort()},U+=t.size}),l("uploading",{files:e,xhr:a}),p.value.push(a),C===!0?a.send(new Blob(e)):a.send(s)}return{isUploading:P,isBusy:N,abort:A,upload:Q}}var G={name:"QUploader",props:T,emits:V,injectPlugin:j},X=k(G);const J={class:"column items-start"},ue={setup(u){return(l,o)=>(H(),L(O,{class:"flex flex-center"},{default:D(()=>[I("div",J,[M(X,{url:"http://192.168.1.210:3000/upload",style:{"max-width":"300px"}})])]),_:1}))}};export{ue as default};
